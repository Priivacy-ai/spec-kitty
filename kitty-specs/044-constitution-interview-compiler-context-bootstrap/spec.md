# Feature Specification: Constitution Interview Compiler + First-Load Context Bootstrap

**Feature Branch**: `044-constitution-interview-compiler-context-bootstrap`  
**Created**: 2026-02-22  
**Status**: Draft  
**Target Branch**: `2.x`

## Goals

- Rebuild constitution creation as an interview-driven compiler, not a static scaffold.
- Generate a concise constitution that references curated doctrine sources.
- Materialize referenced doctrine content into project-local constitution library files.
- Ensure `specify`, `plan`, `implement`, and `review` get constitution context bootstrap on first use.
- Keep behavior deterministic and compatible with current constitution sync extraction.

## User Scenarios & Testing

### User Story 1 - Interview-Driven Constitution Creation (Priority: P1)

As a maintainer, I can run a guided interview and generate constitution artifacts from answers.

**Acceptance**:

1. `spec-kitty constitution interview` writes `.kittify/constitution/interview/answers.yaml`.
2. `spec-kitty constitution generate` compiles answers + doctrine into:
   - `.kittify/constitution/constitution.md`
   - `.kittify/constitution/references.yaml`
   - `.kittify/constitution/library/*.md`
3. Existing extraction files (`governance.yaml`, `directives.yaml`, `metadata.yaml`) are still generated by sync.

### User Story 2 - Constitution Summaries + References (Priority: P1)

As a user, the constitution is short and readable while still linked to full source materials.

**Acceptance**:

1. Constitution contains concise policy summaries.
2. Constitution lists reference IDs and file paths to full material in `.kittify/constitution/library/`.
3. Reference manifest includes source, summary, and local path for each imported item.

### User Story 3 - First-Load Context Bootstrap (Priority: P1)

As an agent operator, first execution of `specify`, `plan`, `implement`, `review` includes constitution context automatically.

**Acceptance**:

1. First-time action prompt includes constitution summary + references.
2. Subsequent runs for the same action use compact governance context.
3. Bootstrap state is tracked in `.kittify/constitution/context-state.json`.

### User Story 4 - Command Template Integration (Priority: P2)

As a slash-command user, mission command templates call a runtime command to load bootstrap context.

**Acceptance**:

1. `specify.md`, `plan.md`, `implement.md`, `review.md` templates include `spec-kitty constitution context --action ...` usage.
2. Template guidance remains compatible with existing workflow commands.

## Requirements

### Functional Requirements

- **FR-001**: Add constitution interview persistence API and CLI command.
- **FR-002**: Replace static constitution generation with interview compiler output.
- **FR-003**: Compiler must materialize doctrine references into project-local library docs.
- **FR-004**: Add constitution context API/CLI with first-load tracking by action.
- **FR-005**: `next` prompt builder must include bootstrap constitution context for target actions.
- **FR-006**: Agent workflow implement/review prompt output must include constitution context.
- **FR-007**: Software-dev command templates for `specify/plan/implement/review` must call constitution context bootstrap command.

### Non-Goals

- Mission state-machine redesign.
- Telemetry expansion.
- New doctrine entity categories or orchestration runtime.

## Success Criteria

- **SC-001**: Constitution interview + generate work end-to-end in a clean repo.
- **SC-002**: Generated constitution remains parseable by current sync/extractor.
- **SC-003**: Prompt tests validate first-run bootstrap vs subsequent compact behavior.
- **SC-004**: CLI tests validate new `interview` and `context` subcommands.
