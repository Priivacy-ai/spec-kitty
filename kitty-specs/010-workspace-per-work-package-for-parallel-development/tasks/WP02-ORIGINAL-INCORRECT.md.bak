---
work_package_id: "WP02"
subtasks:
  - "T008"
  - "T009"
  - "T010"
  - "T011"
  - "T012"
  - "T013"
  - "T014"
  - "T015"
title: "Migration Tests (TDD - Agent Template Coverage)"
phase: "Phase 0 - Test Infrastructure"
lane: "doing"
dependencies: ["WP01"]
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-01-07T00:00:00Z"
    lane: "planned"
    agent: "system"
    shell_pid: ""
    action: "Prompt generated via /spec-kitty.tasks"
---

# Work Package Prompt: WP02 – Migration Tests (TDD - Agent Template Coverage)

**Implementation command:**
```bash
spec-kitty implement WP02 --base WP01
```

## Objectives & Success Criteria

**Primary Goal**: Write migration tests that verify all 12 agent templates are updated exhaustively for workspace-per-WP workflow. Tests must FAIL initially to prevent missing template updates.

**Success Criteria**:
- ✅ test_workspace_per_wp_migration.py created with parametrized tests across all 12 agents
- ✅ Tests validate all 4 templates per agent (specify, plan, tasks, implement)
- ✅ Tests check content, not just file existence
- ✅ All tests FAIL initially (templates not yet updated)

---

## Context & Constraints

**Critical**: This feature requires updating 48 template files (4 × 12 agents). Previous migrations (bash→python) missed templates, causing broken workflows. These tests prevent that.

**AGENT_DIRS**: Use canonical list from `src/specify_cli/upgrade/migrations/m_0_9_1_complete_lane_migration.py`:
- `.claude/commands/`, `.github/prompts/`, `.gemini/commands/`, `.cursor/commands/`, `.qwen/commands/`, `.opencode/command/`, `.windsurf/workflows/`, `.codex/prompts/`, `.kilocode/workflows/`, `.augment/commands/`, `.roo/commands/`, `.amazonq/prompts/`

**Reference**: [plan.md](../plan.md) Section 1.4 (Migration Design), [data-model.md](../data-model.md) Appendix (Migration Checklist)

---

## Subtasks & Detailed Guidance

### T008 – Create migration test file

Create `tests/specify_cli/test_workspace_per_wp_migration.py` with imports and AGENT_DIRS constant.

### T009 – Test AGENT_DIRS completeness

Verify AGENT_DIRS includes all 12 agents (no agents missing from list).

### T010 – Test specify.md template updates

Parametrized test: For each agent, verify `specify.md` does NOT contain worktree creation instructions, DOES contain "commit to main" instructions.

### T011 – Test plan.md template updates

Parametrized test: For each agent, verify `plan.md` does NOT reference "navigate to worktree", DOES work in main repo.

### T012 – Test tasks.md template updates

Parametrized test: For each agent, verify `tasks.md` includes dependency parsing instructions, generates `dependencies:` field in WP frontmatter.

### T013 – Test implement.md template existence

Parametrized test: For each agent, verify `implement.md` EXISTS, documents `--base` flag, shows example commands.

### T014 – Test pre-upgrade validation

Test that migration validates for legacy worktrees, blocks if found, provides cleanup guidance.

### T015 – Run tests, verify FAIL

Run full test suite - all tests should FAIL (templates not updated yet). This validates tests are actually checking.

---

## Test Strategy

**Test file**: `tests/specify_cli/test_workspace_per_wp_migration.py`

**Execution**:
```bash
pytest tests/specify_cli/test_workspace_per_wp_migration.py -v
```

**Expected**: All tests FAIL initially (this is TDD - implementation comes later in WP07)

---

## Definition of Done

- [ ] Migration test file created
- [ ] All 7 test functions written (T009-T014, plus parametrized variants)
- [ ] Tests run and FAIL (validating they actually check conditions)
- [ ] Test coverage for 48 template files (4 × 12 agents)

---

## Activity Log

- 2026-01-07T00:00:00Z – system – lane=planned – Prompt created via /spec-kitty.tasks
- 2026-01-08T09:24:49Z – agent – lane=doing – Started implementation via workflow command
- 2026-01-08T09:27:24Z – unknown – lane=for_review – Migration tests complete. 127 tests written (124 failing as expected per TDD). Tests validate all 48 template files (4 × 12 agents) plus migration validation logic. Ready for review before template implementation in WP07.
- 2026-01-08T09:27:46Z – agent – lane=doing – Started review via workflow command
