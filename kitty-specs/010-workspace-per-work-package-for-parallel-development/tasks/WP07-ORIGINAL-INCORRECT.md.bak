---
work_package_id: "WP07"
subtasks:
  - "T049"
  - "T050"
  - "T051"
  - "T052"
  - "T053"
  - "T054"
  - "T055"
  - "T056"
  - "T057"
  - "T058"
  - "T059"
  - "T060"
  - "T061"
  - "T062"
  - "T063"
  - "T064"
  - "T065"
  - "T066"
  - "T067"
  - "T068"
  - "T069"
title: "Migration Implementation"
phase: "Phase 2 - Migration & Templates"
lane: "planned"
dependencies: ["WP02"]
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-01-07T00:00:00Z"
    lane: "planned"
    agent: "system"
    shell_pid: ""
    action: "Prompt generated via /spec-kitty.tasks"
---

# Work Package Prompt: WP07 – Migration Implementation

**Implementation command:**
```bash
spec-kitty implement WP07 --base WP02
```

## ⚠️ IMPORTANT: Review Feedback Status

**Read this first if you are implementing this task!**

- **Has review feedback?**: Check the `review_status` field above. If it says `has_feedback`, scroll to the **Review Feedback** section immediately.
- **You must address all feedback** before your work is complete.
- **Mark as acknowledged**: Update `review_status: acknowledged` when you begin addressing feedback.

---

## Review Feedback

> **Populated by `/spec-kitty.review`** – Reviewers add detailed feedback here when work needs changes.

*[This section is empty initially. Reviewers will populate it if needed.]*

---

## Objectives & Success Criteria

**Primary Goal**: Implement migration `m_0_11_0_workspace_per_wp.py` with pre-upgrade validation and update ALL 12 agent template directories with new workspace-per-WP workflow. Make migration tests (WP02) pass.

**Success Criteria**:
- ✅ Migration file created with pre-upgrade validation logic
- ✅ ALL 48 template files updated (4 templates × 12 agents)
- ✅ Migration tests (WP02) pass 100%
- ✅ Pre-upgrade validation blocks when legacy worktrees exist
- ✅ list-legacy-features utility command created

**Critical**: This is the largest WP with 48 template files to update. Use TDD approach - migration tests (WP02) must pass to validate completeness.

---

## Context & Constraints

**Why this matters**: Previous migrations (bash→python) missed template updates, leaving some agents with broken workflows. This WP uses test-driven approach to prevent gaps - WP02 tests will FAIL until all 48 templates are updated.

**Reference Documents**:
- [plan.md](../plan.md) - Section 1.4: Migration Design, Implementation Notes (TDD Approach)
- [data-model.md](../data-model.md) - Appendix: Migration Checklist (48 files)
- [spec.md](../spec.md) - FR-024 (backward compatibility)

**AGENT_DIRS Canonical Source**: `src/specify_cli/upgrade/migrations/m_0_9_1_complete_lane_migration.py`

**12 Agent Directories**:
1. `.claude/commands/`
2. `.github/prompts/`
3. `.gemini/commands/`
4. `.cursor/commands/`
5. `.qwen/commands/`
6. `.opencode/command/`
7. `.windsurf/workflows/`
8. `.codex/prompts/`
9. `.kilocode/workflows/`
10. `.augment/commands/`
11. `.roo/commands/`
12. `.amazonq/prompts/`

**4 Templates per Agent**:
- `specify.md` - Update to remove worktree creation, add commit to main
- `plan.md` - Update to remove worktree references, work in main
- `tasks.md` - Update to add dependency parsing and frontmatter generation
- `implement.md` - NEW template documenting `spec-kitty implement WP## [--base WP##]`

**Total**: 48 template files (12 × 4)

---

## Subtasks & Detailed Guidance

### Subtask T049 – Create migration file

**Purpose**: Create migration file structure for 0.11.0 upgrade.

**Steps**:
1. Create `src/specify_cli/upgrade/migrations/m_0_11_0_workspace_per_wp.py`
2. Add migration metadata:
   ```python
   """Migration for workspace-per-WP feature (0.11.0).

   Breaking change: Planning commands no longer create worktrees.
   Blocks upgrade if legacy worktrees exist.
   """

   MIGRATION_ID = "m_0_11_0_workspace_per_wp"
   MIGRATION_VERSION = "0.11.0"
   MIGRATION_DESCRIPTION = "Workspace-per-WP model with dependency tracking"

   # Agent directories to update
   AGENT_DIRS = [
       ".claude/commands/",
       ".github/prompts/",
       ".gemini/commands/",
       ".cursor/commands/",
       ".qwen/commands/",
       ".opencode/command/",
       ".windsurf/workflows/",
       ".codex/prompts/",
       ".kilocode/workflows/",
       ".augment/commands/",
       ".roo/commands/",
       ".amazonq/prompts/",
   ]
   ```

3. Define migration functions (to be implemented in T050-T067):
   - `validate_upgrade()`
   - `detect_legacy_worktrees()`
   - `update_agent_templates()`
   - `run_migration()`

**Files**: `src/specify_cli/upgrade/migrations/m_0_11_0_workspace_per_wp.py`

**Parallel?**: No (foundation for T050-T067)

---

### Subtask T050 – Implement pre-upgrade validation

**Purpose**: Block upgrade to 0.11.0 if any legacy worktrees exist, guiding users to complete or delete them first.

**Steps**:
1. Implement validation function:
   ```python
   def validate_upgrade(project_root: Path) -> tuple[bool, list[str]]:
       """Validate project is ready for 0.11.0 upgrade.

       Returns: (is_valid, error_messages)
       """
       legacy_worktrees = detect_legacy_worktrees(project_root)

       if legacy_worktrees:
           errors = [
               "Cannot upgrade to 0.11.0 - legacy worktrees detected:",
               ""
           ]
           for wt in legacy_worktrees:
               errors.append(f"  - {wt.name}")

           errors.extend([
               "",
               "Action required before upgrade:",
               "  1. Complete features: spec-kitty merge <feature>",
               "  2. OR delete worktrees: git worktree remove .worktrees/<feature>",
               "",
               "Use: spec-kitty list-legacy-features to see all legacy worktrees"
           ])
           return False, errors

       return True, []
   ```

2. Call validation in migration's run_migration() function:
   ```python
   def run_migration(project_root: Path, console: Console) -> bool:
       """Run 0.11.0 migration."""
       # Pre-flight validation
       is_valid, errors = validate_upgrade(project_root)
       if not is_valid:
           for err in errors:
               console.print(f"[red]{err}[/red]")
           return False

       # If valid, proceed with template updates
       update_agent_templates(project_root, console)
       return True
   ```

**Files**: `src/specify_cli/upgrade/migrations/m_0_11_0_workspace_per_wp.py`

**Parallel?**: No (sequential with T051)

---

### Subtask T051 – Implement legacy worktree detection

**Purpose**: Scan `.worktrees/` directory for legacy pattern (###-feature without -WP## suffix).

**Steps**:
1. Implement detection function:
   ```python
   def detect_legacy_worktrees(project_root: Path) -> list[Path]:
       """Find legacy worktrees (pre-0.11.0).

       Legacy pattern: .worktrees/###-feature-name/
       New pattern: .worktrees/###-feature-name-WP##/

       Returns: List of legacy worktree paths
       """
       worktrees_dir = project_root / ".worktrees"
       if not worktrees_dir.exists():
           return []

       legacy_worktrees = []

       for item in worktrees_dir.iterdir():
           if not item.is_dir():
               continue

           # Check if name matches feature pattern (###-feature)
           # but does NOT match workspace-per-WP pattern (###-feature-WP##)
           name = item.name
           has_feature_pattern = re.match(r'^\d{3}-', name)
           has_wp_suffix = re.search(r'-WP\d{2}$', name)

           if has_feature_pattern and not has_wp_suffix:
               # This is a legacy worktree
               legacy_worktrees.append(item)

       return legacy_worktrees
   ```

**Files**: `src/specify_cli/upgrade/migrations/m_0_11_0_workspace_per_wp.py`

**Test**:
```python
def test_detect_legacy_worktrees():
    """Test detection of legacy vs new worktrees."""
    # Setup worktrees
    worktrees = tmp_path / ".worktrees"
    (worktrees / "008-unified-cli").mkdir(parents=True)  # Legacy
    (worktrees / "010-workspace-per-wp-WP01").mkdir(parents=True)  # New
    (worktrees / "010-workspace-per-wp-WP02").mkdir(parents=True)  # New

    legacy = detect_legacy_worktrees(tmp_path)
    assert len(legacy) == 1
    assert legacy[0].name == "008-unified-cli"
```

**Parallel?**: No (called by T050)

---

### Subtask T052 – Block upgrade with clear error

**Purpose**: When legacy worktrees detected, fail migration with actionable error message.

**Steps**:
1. Format error message with specific feature names:
   ```python
   if not is_valid:
       console.print("\n[bold red]❌ Cannot upgrade to 0.11.0[/bold red]\n")
       for err in errors:
           console.print(err)
       console.print()
       return False
   ```

2. Exit migration without making changes
3. Ensure error message includes:
   - Which worktrees are blocking upgrade
   - How to complete features (spec-kitty merge)
   - How to delete worktrees (git worktree remove)
   - Utility command (spec-kitty list-legacy-features)

**Files**: `src/specify_cli/upgrade/migrations/m_0_11_0_workspace_per_wp.py`

**Parallel?**: No (error handling in T050)

**Example Error**:
```
❌ Cannot upgrade to 0.11.0

Legacy worktrees detected:
  - 008-unified-python-cli
  - 009-jujutsu-vcs-integration-and-abstraction

Action required before upgrade:
  1. Complete features: spec-kitty merge 008-unified-python-cli
  2. OR delete worktrees: git worktree remove .worktrees/008-unified-python-cli

Use: spec-kitty list-legacy-features to see all legacy worktrees
```

---

### Subtask T053 – Update .claude/commands/specify.md

**Purpose**: Update Claude Code's specify template to remove worktree creation and add commit-to-main workflow.

**Steps**:
1. Open `.claude/commands/specify.md`
2. Find section about worktree creation (likely mentions "Creates `.worktrees/###-feature/`")
3. REMOVE that section
4. ADD new section:
   ```markdown
   ## Workflow Changes (0.11.0+)

   **IMPORTANT**: Planning commands no longer create worktrees!

   - `/spec-kitty.specify` works in **main repository**
   - Creates `kitty-specs/###-feature/spec.md` directly in main
   - Automatically commits to main branch
   - **NO WORKTREE CREATED**

   Worktrees are created later during `/spec-kitty.implement WP##`
   ```

5. Update any instructions about navigating to worktree (remove those)
6. Update outline to reflect working in main repo

**Files**: `.claude/commands/specify.md`

**Validation**: Read updated file, verify:
- No mention of "creates worktree" or "navigate to .worktrees/"
- Mentions "commits to main"
- Explains worktrees created during implement

**Parallel?**: YES - can update in parallel with other agent templates (T057-T067)

---

### Subtask T054 – Update .claude/commands/plan.md

**Purpose**: Update Claude Code's plan template to work in main repository without worktree context.

**Steps**:
1. Open `.claude/commands/plan.md`
2. Find any references to "worktree", "feature branch", "navigate to"
3. Remove worktree-specific instructions
4. Update location verification section:
   ```markdown
   ## Location Check

   This command works in the **main repository**, NOT in a worktree.

   - Verify you're on the main branch
   - Planning artifacts are in: `kitty-specs/###-feature/`
   - Auto-commits plan.md to main after generation
   ```

5. Remove any cd commands to worktree directories

**Files**: `.claude/commands/plan.md`

**Parallel?**: YES - can update in parallel with T053, T055-T067

---

### Subtask T055 – Update .claude/commands/tasks.md

**Purpose**: Update Claude Code's tasks template to parse dependencies and generate them in WP frontmatter.

**Steps**:
1. Open `.claude/commands/tasks.md`
2. Add new section about dependency detection:
   ```markdown
   ## Dependency Detection (0.11.0+)

   **Parse dependencies from tasks.md**:
   - Look for explicit "Depends on WP##" phrases
   - Look for phase grouping (Phase 2 depends on Phase 1)
   - Extract dependency relationships

   **Generate dependencies in WP frontmatter**:
   ```yaml
   ---
   work_package_id: "WP02"
   title: "Build API"
   lane: "planned"
   dependencies: ["WP01"]  # ← GENERATE THIS
   ---
   ```

   **Include correct implementation command in WP prompt**:
   - No dependencies: `spec-kitty implement WP01`
   - With dependencies: `spec-kitty implement WP02 --base WP01`
   ```

3. Update WP prompt generation section to include dependencies field
4. Mention auto-commit to main after tasks generation

**Files**: `.claude/commands/tasks.md`

**Parallel?**: YES - can update in parallel with T053-T054, T056-T067

---

### Subtask T056 – Create .claude/commands/implement.md (NEW)

**Purpose**: Create NEW template documenting the implement command for Claude Code.

**Steps**:
1. Create `.claude/commands/implement.md` (new file)
2. Document command purpose:
   ```markdown
   # /spec-kitty.implement - Create Workspace for Work Package

   **Version**: 0.11.0+
   **Purpose**: Create isolated workspace (git worktree) for implementing a specific work package.

   ## Command Syntax

   ```bash
   spec-kitty implement WP##           # No dependencies (branches from main)
   spec-kitty implement WP## --base WPXX  # With dependencies (branches from WP base)
   ```

   ## When to Use

   After `/spec-kitty.tasks` has generated work packages in main repository:
   - Run `spec-kitty implement WP01` to create workspace for first WP
   - Run `spec-kitty implement WP02 --base WP01` if WP02 depends on WP01
   - Each WP gets its own isolated worktree in `.worktrees/###-feature-WP##/`

   ## Examples

   **Independent WP** (no dependencies):
   ```bash
   spec-kitty implement WP01
   # Creates: .worktrees/010-workspace-per-wp-WP01/
   # Branches from: main
   # Contains: Planning artifacts (spec, plan, tasks)
   ```

   **Dependent WP**:
   ```bash
   spec-kitty implement WP02 --base WP01
   # Creates: .worktrees/010-workspace-per-wp-WP02/
   # Branches from: 010-workspace-per-wp-WP01 branch
   # Contains: Planning artifacts + WP01's code changes
   ```

   ## Validation

   - Validates base workspace exists (if --base specified)
   - Suggests --base if WP has dependencies in frontmatter
   - Errors if trying to branch from non-existent base

   ## Parallel Development

   Multiple agents can run implement for different WPs simultaneously:
   ```bash
   # Agent A
   spec-kitty implement WP01

   # Agent B (in parallel!)
   spec-kitty implement WP03

   # Both work in isolated worktrees without conflicts
   ```
   ```

3. Include troubleshooting section for common errors

**Files**: `.claude/commands/implement.md` (NEW file)

**Parallel?**: YES - can create in parallel with T053-T055, T057-T067

**Template Content**: Comprehensive guide for agents using implement command, including syntax, examples, validation, parallel development patterns.

---

### Subtasks T057-T067 – Update Templates for 11 Other Agents

**Purpose**: Repeat template updates (T053-T056) for each of the remaining 11 agent directories.

**Pattern**: Each agent needs the same 4 template updates:
1. Update specify template (remove worktree creation)
2. Update plan template (remove worktree references)
3. Update tasks template (add dependency generation)
4. Create implement template (NEW file)

**Agent Directory Structure**:
```
<agent-dir>/<subdirectory>/<template-name>.md

Examples:
  .github/prompts/specify.md
  .gemini/commands/specify.md
  .cursor/commands/specify.md
  .opencode/command/specify.md  (note: "command" not "commands")
```

### T057 – Update .github/prompts/ (GitHub Copilot)

- Update `.github/prompts/specify.md`
- Update `.github/prompts/plan.md`
- Update `.github/prompts/tasks.md`
- Create `.github/prompts/implement.md`

### T058 – Update .gemini/commands/ (Google Gemini)

- Update `.gemini/commands/specify.md`
- Update `.gemini/commands/plan.md`
- Update `.gemini/commands/tasks.md`
- Create `.gemini/commands/implement.md`

### T059 – Update .cursor/commands/ (Cursor)

- Update `.cursor/commands/specify.md`
- Update `.cursor/commands/plan.md`
- Update `.cursor/commands/tasks.md`
- Create `.cursor/commands/implement.md`

### T060 – Update .qwen/commands/ (Qwen Code)

- Update `.qwen/commands/specify.md`
- Update `.qwen/commands/plan.md`
- Update `.qwen/commands/tasks.md`
- Create `.qwen/commands/implement.md`

### T061 – Update .opencode/command/ (OpenCode)

**NOTE**: OpenCode uses `command/` not `commands/` (singular)

- Update `.opencode/command/specify.md`
- Update `.opencode/command/plan.md`
- Update `.opencode/command/tasks.md`
- Create `.opencode/command/implement.md`

### T062 – Update .windsurf/workflows/ (Windsurf)

- Update `.windsurf/workflows/specify.md`
- Update `.windsurf/workflows/plan.md`
- Update `.windsurf/workflows/tasks.md`
- Create `.windsurf/workflows/implement.md`

### T063 – Update .codex/prompts/ (GitHub Codex)

- Update `.codex/prompts/specify.md`
- Update `.codex/prompts/plan.md`
- Update `.codex/prompts/tasks.md`
- Create `.codex/prompts/implement.md`

### T064 – Update .kilocode/workflows/ (Kilocode)

- Update `.kilocode/workflows/specify.md`
- Update `.kilocode/workflows/plan.md`
- Update `.kilocode/workflows/tasks.md`
- Create `.kilocode/workflows/implement.md`

### T065 – Update .augment/commands/ (Augment Code)

- Update `.augment/commands/specify.md`
- Update `.augment/commands/plan.md`
- Update `.augment/commands/tasks.md`
- Create `.augment/commands/implement.md`

### T066 – Update .roo/commands/ (Roo Cline)

- Update `.roo/commands/specify.md`
- Update `.roo/commands/plan.md`
- Update `.roo/commands/tasks.md`
- Create `.roo/commands/implement.md`

### T067 – Update .amazonq/prompts/ (Amazon Q)

- Update `.amazonq/prompts/specify.md`
- Update `.amazonq/prompts/plan.md`
- Update `.amazonq/prompts/tasks.md`
- Create `.amazonq/prompts/implement.md`

**All T057-T067 Parallel?**: YES - All 11 agent directories can be updated in parallel. This is the massive parallelization opportunity for this WP.

---

### Subtask T068 – Run migration tests, verify PASS

**Purpose**: Execute migration tests (from WP02) and verify ALL tests pass, validating exhaustive template updates.

**Steps**:
1. Run migration test suite:
   ```bash
   pytest tests/specify_cli/test_workspace_per_wp_migration.py -v
   ```

2. Verify all tests PASS:
   - test_agent_dirs_complete → PASS (all 12 agents in AGENT_DIRS)
   - test_specify_template_updated (12 parametrized variants) → PASS
   - test_plan_template_updated (12 parametrized variants) → PASS
   - test_tasks_template_updated (12 parametrized variants) → PASS
   - test_implement_template_exists (12 parametrized variants) → PASS
   - test_pre_upgrade_validation → PASS

3. If any test FAILS:
   - Identify which agent/template was missed
   - Update that template (back to T053-T067)
   - Re-run tests until all pass

**Execution**:
```bash
pytest tests/specify_cli/test_workspace_per_wp_migration.py -v --tb=short
```

**Expected Result**: All tests PASS (initially they FAILED in WP02, now they should PASS after template updates)

**Files**: N/A (test execution)

**Parallel?**: No (validation step after all updates)

---

### Subtask T069 – Add list-legacy-features utility command

**Purpose**: Provide users with command to check for legacy worktrees before upgrading.

**Steps**:
1. Add utility command to CLI (could be in implement.py or separate utility file):
   ```python
   def list_legacy_features() -> None:
       """List legacy worktrees that must be cleaned up before 0.11.0 upgrade."""
       from specify_cli.tasks_support import find_repo_root
       repo_root = find_repo_root()

       legacy = detect_legacy_worktrees(repo_root)

       if not legacy:
           console.print("[green]✓[/green] No legacy worktrees found")
           console.print("Project is ready for 0.11.0 upgrade")
           return

       console.print(f"[yellow]Legacy worktrees found:[/yellow] {len(legacy)}\n")
       for wt in legacy:
           console.print(f"  - {wt.name}")

       console.print("\n[cyan]Action required:[/cyan]")
       console.print("  Complete: spec-kitty merge <feature>")
       console.print("  OR Delete: git worktree remove .worktrees/<feature>")
   ```

2. Register command in CLI router:
   ```python
   app.command(name="list-legacy-features")(list_legacy_features)
   ```

**Files**: `src/specify_cli/cli/commands/implement.py` or new `utilities.py`

**Parallel?**: Can implement in parallel with template updates

**Usage**:
```bash
spec-kitty list-legacy-features

# Output:
# Legacy worktrees found: 2
#   - 008-unified-python-cli
#   - 009-jujutsu-vcs-integration
#
# Action required:
#   Complete: spec-kitty merge <feature>
#   OR Delete: git worktree remove .worktrees/<feature>
```

---

## Template Update Checklist

**For each agent, verify ALL 4 templates updated:**

### .claude/commands/
- [ ] specify.md - Removed worktree creation
- [ ] plan.md - Removed worktree references
- [ ] tasks.md - Added dependency generation
- [ ] implement.md - NEW file created

### .github/prompts/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .gemini/commands/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .cursor/commands/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .qwen/commands/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .opencode/command/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .windsurf/workflows/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .codex/prompts/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .kilocode/workflows/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .augment/commands/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .roo/commands/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

### .amazonq/prompts/
- [ ] specify.md
- [ ] plan.md
- [ ] tasks.md
- [ ] implement.md

**Total**: 48 files (12 agents × 4 templates)

---

## Template Content Guidelines

**All specify.md templates should include**:
- "Planning commands work in main repository (0.11.0+)"
- "NO worktree created during specify"
- "Auto-commits spec.md to main branch"
- "Worktrees created later during implement"

**All plan.md templates should include**:
- "Works in main repository, not worktree"
- "Commits plan.md to main"
- "Verify you're on main branch before running"

**All tasks.md templates should include**:
- "Parse dependencies from tasks.md structure"
- "Generate dependencies: [] field in WP frontmatter"
- "Include correct spec-kitty implement command with --base flag"
- "Auto-commits tasks/*.md to main"

**All implement.md templates should include**:
- "Creates workspace for single WP"
- "Syntax: spec-kitty implement WP## [--base WPXX]"
- "Examples with and without dependencies"
- "Parallel development explanation"

---

## Test Strategy

**Migration Tests (from WP02)**: Validate all templates updated

**Test File**: `tests/specify_cli/test_workspace_per_wp_migration.py`

**Execution**:
```bash
pytest tests/specify_cli/test_workspace_per_wp_migration.py -v
```

**What tests check**:
- AGENT_DIRS includes all 12 agents
- Each agent has specify.md WITHOUT "creates worktree" text
- Each agent has plan.md WITHOUT "navigate to worktree" text
- Each agent has tasks.md WITH "dependencies:" and "spec-kitty implement" text
- Each agent has implement.md file EXISTS

**All tests must PASS** - this is the exit criteria for WP07.

---

## Risks & Mitigations

**Risk 1: Missing template update**
- Impact: Agent has broken workflow after 0.11.0 upgrade
- Mitigation: Migration tests catch missing updates (parametrized across all agents)

**Risk 2: Inconsistent template content across agents**
- Impact: Different agents have different instructions, confusion
- Mitigation: Use consistent content patterns, copy-paste core sections across agents

**Risk 3: Template update breaks existing template structure**
- Impact: Agent template has syntax errors or broken formatting
- Mitigation: Validate template structure after update, test with actual agent if possible

**Risk 4: Pre-upgrade validation too strict**
- Impact: Blocks legitimate upgrades
- Mitigation: Only block if legacy worktrees actually exist, provide clear cleanup instructions

---

## Definition of Done Checklist

- [ ] Migration file created (T049)
- [ ] Pre-upgrade validation implemented (T050-T052)
- [ ] All 48 template files updated:
  - [ ] 12 specify.md files updated (T053, T057-T067)
  - [ ] 12 plan.md files updated (T054, T057-T067)
  - [ ] 12 tasks.md files updated (T055, T057-T067)
  - [ ] 12 implement.md files created (T056, T057-T067)
- [ ] Migration tests PASS (T068)
- [ ] list-legacy-features utility command created (T069)
- [ ] Manual verification: Check 3 random agents, verify templates updated correctly

---

## Review Guidance

**Reviewers should verify**:
1. **Exhaustive coverage**: All 12 agents updated (use migration test as checklist)
2. **Content consistency**: All templates have similar instructions (not wildly different)
3. **Migration tests pass**: Run pytest, verify 100% pass
4. **Pre-upgrade validation works**: Test with legacy worktree present, verify blocks upgrade
5. **No broken templates**: Spot-check 3-4 agent templates for syntax errors

**Key Acceptance Checkpoints**:
- Run migration tests: `pytest tests/specify_cli/test_workspace_per_wp_migration.py -v` → ALL PASS
- Check 3 random agent directories (.cursor, .codex, .augment), verify all 4 files updated
- Test pre-upgrade validation: Create fake legacy worktree, run upgrade, verify blocked

**Massive Parallel Work Opportunity**: T053-T067 (15 subtasks) can ALL run in parallel - different agent directories. Ideal for multi-agent implementation!

---

## Activity Log

- 2026-01-07T00:00:00Z – system – lane=planned – Prompt created via /spec-kitty.tasks

---

### Updating Lane Status

Move this WP between lanes using:
```bash
spec-kitty agent tasks move-task WP07 --to <lane>
```

Or edit the `lane:` field in frontmatter directly.
