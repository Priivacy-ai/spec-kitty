{
  "feature_number": "041",
  "slug": "041-enable-plan-mission-runtime-support",
  "friendly_name": "Enable plan mission runtime support on 2.x",
  "mission": "software-dev",
  "source_description": "Team: spec-kitty\nPriority: P0\nScope: 2.x ONLY (no mainline, no doctrine migration/refactor)\n\nBranch policy:\n- Work only on branch line `2.x`.\n- Do not port/rename assets to doctrine paths.\n- Do not introduce unrelated PR146 changes.\n\nProblem:\n`plan` mission can be selected, but `spec-kitty next --feature ... --agent ... --json` blocks for `mission=plan`.\n\nObserved behavior:\n1) `spec-kitty specify \"plan adoption feature\" --mission plan --json` succeeds.\n2) `spec-kitty next --feature <slug> --agent codex --json` returns blocked with:\n   \"Failed to start/load runtime run: Mission 'plan' not found ...\"\n3) Command/template resolution for mission=plan fails because plan mission has only:\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/mission.yaml`\n   - empty `/command-templates/.gitkeep`\n   - empty `/templates/.gitkeep`\n\nRoot cause:\nThe runtime bridge expects runtime-compatible mission template + mission-scoped command templates.\nRelevant code:\n- `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/next/runtime_bridge.py` around lines 214, 244, 302.\n\nGoal:\nMake `plan` mission work end-to-end in the `next` runtime loop on 2.x.\n\nRequired changes (minimal, 2.x-safe):\n1) Add runtime template for `plan` mission:\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/mission-runtime.yaml`\n   - Use runtime schema (`mission.key`, `steps`, `depends_on`, `prompt_template`).\n   - Keep semantics aligned with existing plan mission phases (goals/research/structure/draft/review).\n\n2) Add mission-scoped command templates for `plan`:\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/command-templates/specify.md`\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/command-templates/research.md`\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/command-templates/plan.md`\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/command-templates/review.md`\n   - Keep template references in these files 2.x-consistent (no doctrine path assumptions).\n\n3) Add mission-scoped content templates needed by the above command templates (only if referenced):\n   - `/Users/robert/ClaudeCowork/Spec-Kitty-Cowork/spec-kitty/src/specify_cli/missions/plan/templates/...`\n\n4) Tests:\n   - Add/extend integration test proving:\n     a) create feature with `mission=plan`\n     b) `next` no longer returns blocked \"Mission 'plan' not found\"\n   - Add/extend resolver test proving `resolve_command(..., mission=\"plan\")` resolves required plan command templates.\n   - Keep tests deterministic and runnable in CI without external auth/services.\n\nAcceptance criteria:\n1) On 2.x, in clean temp project:\n   - `spec-kitty specify \"<name>\" --mission plan --json` succeeds.\n   - `spec-kitty next --feature <slug> --agent codex --json` returns non-blocked (`step` / `decision_required` / `terminal`), and does not fail mission discovery.\n2) `mission=plan` command-template resolution succeeds for the expected loop steps.\n3) No behavior regressions for `software-dev` and `research` mission loops.\n4) No changes outside 2.x scope.\n\nOut of scope:\n- No doctrine migration.\n- No SaaS/API changes.\n- No telemetry schema redesign.",
  "created_at": "2026-02-22T17:00:00+00:00",
  "target_branch": "2.x",
  "vcs": "git"
}
