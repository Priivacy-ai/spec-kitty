[project]
name = "spec-kitty-cli"
version = "2.0.1a1"
description = "Spec Kitty, a tool for Specification Driven Development (SDD) agentic projects, with kanban and git worktree isolation."
readme = "README.md"
license = { file = "LICENSE" }
requires-python = ">=3.11"
authors = [
    { name = "Spec Kitty Contributors" },
]
maintainers = [
    { name = "Spec Kitty Contributors" },
]
keywords = [
    "specification",
    "spec-driven-development",
    "sdd",
    "agentic-development",
    "ai-coding",
    "claude-code",
    "ai-agents",
    "llm-tools",
    "code-generation",
    "feature-specs",
    "requirements",
    "planning",
    "kanban",
    "git-worktree",
    "workflow-automation",
    "cli",
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Software Development",
    "Topic :: Software Development :: Code Generators",
    "Topic :: Software Development :: Documentation",
    "Topic :: Software Development :: Quality Assurance",
    "Topic :: Software Development :: Version Control",
    "Topic :: Software Development :: Version Control :: Git",
    "Topic :: Utilities",
    "Environment :: Console",
    "Typing :: Typed",
]
dependencies = [
    "typer",
    "rich",
    "httpx[socks]",
    "platformdirs",
    "readchar",
    "truststore>=0.10.4",
    "pyyaml>=6.0",
    "ruamel.yaml>=0.18.0",
    "pydantic>=2.0",
    "packaging>=23.0",
    "psutil>=5.9.0",  # Cross-platform process management for dashboard
    "spec-kitty-events==2.3.1",
    "spec-kitty-runtime @ git+https://github.com/Priivacy-ai/spec-kitty-runtime.git@v0.2.0a0",
    "websockets>=12.0",  # WebSocket client for sync protocol
    "toml>=0.10.2",  # Config file parsing
    "filelock>=3.13.0",  # Credential storage locking
    "requests>=2.31.0",  # HTTP client for batch sync
    "transitions>=0.9.2",  # State machine library for mission DSL v1
    "jsonschema>=4.0",  # JSON Schema validation for mission configs
]

[project.urls]
Repository = "https://github.com/Priivacy-ai/spec-kitty"
Issues = "https://github.com/Priivacy-ai/spec-kitty/issues"
Documentation = "https://priivacy-ai.github.io/spec-kitty/"
Changelog = "https://github.com/Priivacy-ai/spec-kitty/blob/main/CHANGELOG.md"

[project.optional-dependencies]
test = [
    "pytest>=7.4",
    "pytest-asyncio>=0.21.0",  # Required for async tests
    "pytest-cov>=4.0",  # Coverage reporting
    "build>=1.0.0",  # Required for distribution tests (wheel building)
    "mypy>=1.0",  # Static type checking (constitution: mypy --strict)
    "ruff>=0.1.0",  # Linting (constitution: ruff check)
    "bandit>=1.7",  # Python SAST -- OWASP security scanning (all tiers)
    "pip-audit>=2.6",  # CVE scanning of installed dependencies
]

[project.scripts]
spec-kitty = "specify_cli:main"

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.hatch.metadata]
allow-direct-references = true

[tool.poetry]
requires-poetry = ">=1.8.0"

[tool.poetry.group.dev.dependencies]
pytest = ">=7.4"
pytest-asyncio = ">=0.21.0"
pytest-cov = ">=4.0"
build = ">=1.0.0"
mypy = ">=1.0"
ruff = ">=0.1.0"
bandit = ">=1.7"
pip-audit = ">=2.6"

[tool.hatch.build.targets.wheel]
packages = ["src/specify_cli", "src/doctrine"]
# Include all non-Python files (templates, configs, etc.)
artifacts = [
    "src/specify_cli/**/*.md",
    "src/specify_cli/**/*.yaml",
    "src/specify_cli/**/*.yml",
    "src/specify_cli/**/*.json",
    "src/specify_cli/**/*.csv",
    "src/specify_cli/**/*.template",
    "src/doctrine/**/*.md",
    "src/doctrine/**/*.yaml",
    "src/doctrine/**/*.yml",
    "src/doctrine/**/*.json",
    "src/doctrine/**/*.toml",
]

[tool.hatch.build.targets.sdist]
include = [
    "src/**/*",
    "README.md",
    "LICENSE",
    "CHANGELOG.md",
    "pyproject.toml",
]
exclude = [
    ".kittify/active-mission",
]

[tool.pytest.ini_options]
markers = [
    "adversarial: Adversarial/security tests for 0.13.0",
    "distribution: Tests requiring wheel install (slow, no SPEC_KITTY_TEMPLATE_ROOT)",
    "e2e: End-to-end tests exercising the full CLI workflow (may be slow)",
    "slow: Tests taking >10 seconds",
    "platform_darwin: macOS-specific tests (case-insensitive FS)",
    "platform_linux: Linux-specific tests",
    "requires_symlinks: Tests that need symlink support",
]

[tool.ruff]
line-length = 120

[tool.ruff.format]
# Black-compatible defaults (ruff's default, made explicit)
quote-style = "double"
indent-style = "space"
line-ending = "auto"

[tool.mypy]
# Keep strict mode as the default quality bar for actively maintained code.
strict = true

[tool.coverage.run]
source = ["src/specify_cli", "src/doctrine"]

[tool.coverage.report]
skip_empty = true
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if TYPE_CHECKING:",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "@(abc\\.)?abstractmethod",
]

# ---------------------------------------------------------------------------
# Tiered coverage thresholds
#
# This is the SINGLE SOURCE OF TRUTH for domain classification.
# Keep in sync with: sonar-project.properties (sonar.exclusions)
#                    docs/development/tiered-quality-enforcement.md
#
# Thresholds are enforced by scripts/check_coverage.py (CI + local).
# The global --cov-fail-under flag is NOT used; all checks run here.
# ---------------------------------------------------------------------------

[tool.coverage_tiers.core]
# Critical domain logic -- state machines, VCS abstractions, event infrastructure.
# Highest coverage bar; full SonarCloud analysis applies.
include = [
    "src/specify_cli/status/*",
    "src/specify_cli/core/*",
    "src/specify_cli/merge/*",
    "src/specify_cli/constitution/*",
    "src/specify_cli/git/*",
    "src/specify_cli/events/*",
    "src/specify_cli/next/*",
    "src/specify_cli/spec_kitty_events/*",
    "src/doctrine/*",
]
min_coverage = 80

[tool.coverage_tiers.supporting]
# I/O-heavy and CLI-bound code -- important but harder to unit-test.
# Reduced but enforced threshold; full SonarCloud analysis applies.
include = [
    "src/specify_cli/cli/*",
    "src/specify_cli/glossary/*",
    "src/specify_cli/sync/*",
    "src/specify_cli/frontmatter.py",
]
min_coverage = 55

[tool.coverage_tiers.glue]
# Thin orchestration wiring, UI handlers, utility scripts.
# Coverage tracked but not enforced. Excluded from SonarCloud (quality noise).
# Security scanning via Bandit and pip-audit still applies to all tiers.
include = [
    "src/specify_cli/orchestrator/*",
    "src/specify_cli/orchestrator_api/*",
    "src/specify_cli/dashboard/*",
    "src/specify_cli/scripts/*",
    "src/specify_cli/missions/*",
]
min_coverage = 0

[[tool.mypy.overrides]]
# Transitional quarantine for legacy modules that are still being migrated to strict typing.
module = [
    "specify_cli.agent_utils.status",
    "specify_cli.cli.commands.glossary",
    "specify_cli.cli.ui",
    "specify_cli.core.feature_detection",
    "specify_cli.events.adapter",
    "specify_cli.manifest",
    "specify_cli.mission_v1.compat",
    "specify_cli.mission_v1.events",
    "specify_cli.mission_v1.runner",
    "specify_cli.scripts.tasks.acceptance_support",
    "specify_cli.scripts.tasks.task_helpers",
    "specify_cli.scripts.tasks.tasks_cli",
    "specify_cli.status.validate",
    "specify_cli.sync.auth",
    "specify_cli.sync.background",
    "specify_cli.sync.batch",
    "specify_cli.sync.client",
    "specify_cli.tasks_support",
    "specify_cli.verify_enhanced",
]
ignore_errors = true
